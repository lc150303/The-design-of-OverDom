# 基本Task类【实装】
所有多步骤任务的抽象类，兼容单creep任务和小队任务。  
## 应用需求
房间后期建筑多了以后，物资转运难以通过统一的优先级实现，并且物资转运是个临时需求，每tick统一查找会浪费cpu。开新房、侦查、战斗等临时任务也需要简洁高效的发布机制，这就需要任务系统。
## 设计
* 基础任务类要兼容各种实际功能，提供统一接口
    * 通过 **steps数组** 保存具体功能，减小每个step，方便组合复用（如复用跨房间移动步骤、boost步骤等）
    * 定义 **next_step()** 为统一接口
* 如果每tick都检查任务队列中过期任务并剔除会浪费cpu，设计为执行者接受任务时检查一次是否过期，过期则检查队列中下一个任务，直到接受到有效任务或者任务队列为空。
* 任务发布者需要避免发布重复任务，而任务完成或过期时需要得到通知，以便发布新任务。不应该每tick检查任务情况。
## 类成员
### 成员变量
* name：任务名
* steps：保存任务步骤的数组，具体行为在step中定义。
### 成员方法
* next_step()：取出剩余步骤中第一步，由任务执行者拿去执行。
* recycle_unfinished_step(step)： 执行者遇到意外而任务未过期时，交还未完成的step，将该step插入到步骤数组第一个。
* *is_expire()*： 抽象方法，由任务发布者定义，判断任务是否已过期。
* *notify()*： 抽象方法，由任务发布者定义的回调函数，完成任务或扔掉过期任务时调用，通知任务完成情况，可定义为接受参数。
* all_step_expired()：备选方法，无需特定的expire条件时将这个作为expire条件。
* never_expire()：备选方法，永不过期，直接返回false。

## 使用方式
* 发布
```JavaScript
let task1 = new Task({steps:一些步骤, name:一个字符串});
task1.is_expired = 一些条件;
task1.notify = 特定的回调函数;
```
然后将task1交给任务队列的维护者。
* 接受     

在接受任务的基本creep类（飞蛇基因组）和基本squad类中介绍。
## 扩展
目前由建筑执行的任务未通过此类实现。spawn任务简单不需要此类，lab、factory需求暂时未知。